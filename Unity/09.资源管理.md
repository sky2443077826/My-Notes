# ç¬¬ä¹ç«  èµ„æºç®¡ç†
- [ç¬¬ä¹ç«  èµ„æºç®¡ç†](#ç¬¬ä¹ç« -èµ„æºç®¡ç†)
  - [9.1 Resourcesç±»è¯»å–èµ„æº](#91-resourcesç±»è¯»å–èµ„æº)
    - [9.1.1 Resourcesç±»](#911-resourcesç±»)
    - [9.1.2 å¸¸è§çš„èµ„æºç±»å‹](#912-å¸¸è§çš„èµ„æºç±»å‹)
  - [9.2 AssetBundleç±»æ‰“åŒ…èµ„æº](#92-assetbundleç±»æ‰“åŒ…èµ„æº)
    - [9.2.1 AssetBundle èµ„æºåŒ…](#921-assetbundle-èµ„æºåŒ…)
    - [9.2.2 AssetBundleç®€ä»‹](#922-assetbundleç®€ä»‹)
    - [9.2.3 èµ„æºè®¾ç½®](#923-èµ„æºè®¾ç½®)
    - [9.2.4 BuildPipelineç±»](#924-buildpipelineç±»)
    - [9.2.5 Editoræ‰“åŒ…AssetBundle](#925-editoræ‰“åŒ…assetbundle)
    - [9.2.6 æ‰€æœ‰èµ„æºçš„è¯´æ˜æ¸…å•](#926-æ‰€æœ‰èµ„æºçš„è¯´æ˜æ¸…å•)
    - [9.2.7 æ¯ä¸ªèµ„æºçš„è¯´æ˜æ¸…å•](#927-æ¯ä¸ªèµ„æºçš„è¯´æ˜æ¸…å•)
  - [9.3 AssetBundleåŠ è½½èµ„æº](#93-assetbundleåŠ è½½èµ„æº)
    - [9.3.1 åŠ è½½æµç¨‹](#931-åŠ è½½æµç¨‹)
    - [9.3.2 ä¸‹è½½èµ„æºæ¸…å•](#932-ä¸‹è½½èµ„æºæ¸…å•)
    - [9.3.3 ä¸‹è½½æ¸…å•è¯´æ˜Manifest](#933-ä¸‹è½½æ¸…å•è¯´æ˜manifest)
    - [9.3.4 ä¸‹è½½ä¾èµ–èµ„æº](#934-ä¸‹è½½ä¾èµ–èµ„æº)
    - [9.3.5 ä¸‹è½½ç›®æ ‡èµ„æº](#935-ä¸‹è½½ç›®æ ‡èµ„æº)

## 9.1 Resourcesç±»è¯»å–èµ„æº
### 9.1.1 Resourcesç±»
![](iamges/09/9-1%20Resourcesç±».png)

* Resources.Load
  ```cs
  //é€šè¿‡åç§°è·å–èµ„æº
  Resources.Load("glass");
  //é€šè¿‡åç§°è·å–æŒ‡å®šç±»å‹çš„èµ„æº
  Resources.Load<Texture>("glass");
  //é€šè¿‡åç§°è·å–æŒ‡å®šç±»å‹çš„èµ„æº
  Resources.Load("glass",typeof(Texture) as Texture)
  ```

### 9.1.2 å¸¸è§çš„èµ„æºç±»å‹
![](iamges/09/9-2%20å¸¸è§çš„èµ„æºç±»å‹.png)

## 9.2 AssetBundleç±»æ‰“åŒ…èµ„æº

### 9.2.1 AssetBundle èµ„æºåŒ…
AssetBundle æ˜¯ Unityå¼•æ“ æä¾›çš„â€”ç§èµ„æºå‹ç¼©æ–‡ä»¶ï¼Œæ–‡ä»¶æ‰©å±•åé€šå¸¸ä¸º unity3d æˆ– assetbundle ã€‚

### 9.2.2 AssetBundleç®€ä»‹
* æµç¨‹ï¼š
  * å¼€å‘è€…å¯¹èµ„æºè¿›è¡Œæ‰“åŒ…åä¸Šä¼ åˆ°ç½‘ç»œæœåŠ¡å™¨ä¸Šï¼Œä½¿ç”¨è€…çš„å®¢æˆ·ç«¯ä»ç½‘ç»œä¸ŠåŠ è½½èµ„æºåŒ…ï¼Œè¿›è€Œè·å–æœ€æ–°èµ„æºã€‚
* ç”¨é€”ï¼š
  * æ›´æ–°èµ„æºï¼ˆå¦‚ï¼šæ¸¸æˆå°é¢å‘ç”Ÿå˜åŒ–)  
  * å‹ç¼©èµ„æºï¼Œå‡å°‘æ‰€å ç©ºé—´
* ç‰¹ç‚¹ï¼š
  * èµ„æºä½¿ç”¨çµæ´»  
* é—®é¢˜ï¼š
  * å‹ç¼©å¤±è´¥ï¼Œä¸¢å¤±å…³è”ï¼Œå†…å­˜æº¢å‡ºï¼ŒåŠ è½½å¤±è´¥...

### 9.2.3 èµ„æºè®¾ç½®
![](iamges/09/9-3%20èµ„æºè®¾ç½®.png)

### 9.2.4 BuildPipelineç±»
BuildPipeline.BuildAssetBundlesæ‰“åŒ…èµ„æº
![](iamges/09/9-4%20bulidå…ƒç´ .png)

### 9.2.5 Editoræ‰“åŒ…AssetBundle
```cs
[MenuItem ("Assets/Build AssetBundTes ")]
static void BuildAllAssetBundles
{
  Bui1dPipeline.BuildAssetBundles (Application.dataPath + "/AssetBund7es", Bui1dAssetBundTeoptions.None, BuildTarget.StandaloneOSXIntel);
}
```
* ğŸç¼–è¾‘å¥½ä¸€ä¸ªæè´¨ç´ æå’Œé¢„è®¾ä½“ç´ æçš„AssetBundleåç§°
* ğŸæ‰“åŒ…æˆAssetBundle
![](iamges/09/9-5%20æ‰“åŒ…åæ–‡ä»¶.png)

### 9.2.6 æ‰€æœ‰èµ„æºçš„è¯´æ˜æ¸…å•
* AssetBundles.manifestï¼ˆåç§°ä¸æ–‡ä»¶å¤¹åŒå)
![](iamges/09/9-6%20manifest.png)

### 9.2.7 æ¯ä¸ªèµ„æºçš„è¯´æ˜æ¸…å•
* prefab.redcube.manifest
![](iamges/09/9-7%20æ¯ä¸ªèµ„æºçš„è¯´æ˜æ¸…å•.png)

## 9.3 AssetBundleåŠ è½½èµ„æº
### 9.3.1 åŠ è½½æµç¨‹

![](iamges/09/9-8%20åŠ è½½æµç¨‹.png)

### 9.3.2 ä¸‹è½½èµ„æºæ¸…å•
```cs
//æœåŠ¡å™¨åœ°å€
string Cdn = "http://127.0.0.1/AssetBundles/";
//é¢å¤–çš„æ¸…å•åœ°å€,æ¸…å•æ–‡ä»¶åç§°ä¸å®ƒæ‰€ç”Ÿæˆçš„æ–‡ä»¶å¤¹åç§°â€”è‡´,æœ¬ä¾‹ä¸­ä¸ºAssetBundles
string mUrl = Cdn + "AssetBundles";
//å…ˆä¸‹è½½æ¸…å•
www mwww = www.LoadFromcacheorDownload(mUrl,1);
//ç­‰å¾…ä¸‹è½½
yield return mwww ;
```

### 9.3.3 ä¸‹è½½æ¸…å•è¯´æ˜Manifest
```cs
//è·å–åˆ°æ¸…å•
AssetBundle mab = mwww.assetBundle;
//æ‰¾åˆ°æ¸…å•æ‰€å¯¹åº”çš„è¯´æ˜æ–‡ä»¶Manifest
//å­—ç¬¦ä¸²ä¸ºAssetBundleManifest,å›ºå®šå†™æ³•
AssetBundTeManifest mainfest =(AssetBundleManifest)mab. LoadAsset("AssetBundleManifest");
//æš‚ä¸é”€æ¯èµ„æº
mab. Unload(false);

```

### 9.3.4 ä¸‹è½½ä¾èµ–èµ„æº
```cs
//éœ€è¦åŠ è½½çš„çš„èµ„æº,ä¾‹ä¸­æ˜¯ä¸€ä¸ªé¢„è®¾ä½“
string realName = "prefab.redcube" ;
//è·å–æ­¤èµ„æºçš„ä¾èµ–æ–‡ä»¶
string[] dps = mainfest.GetAllDependencies(realName);
//åˆ›å»ºä¾èµ–èµ„æºåˆ—è¡¨
AssetBundle[] abs = new AssetBundle[dps.Length];
//é€ä¸ªä¸‹è½½æ”¾å…¥åˆ—è¡¨
for int i =0; i < dps.Length; i++)
{
  //æœåŠ¡å™¨åœ°å€fä¾èµ–èµ„æºåç§°
  string dUrl = Cdn + dps[i];
  //ä¸‹è½½ä¾èµ–èµ„æº
  www dwww = WWW.LoadFromCacheorDownload(dUrl, mainfest. GetAssetBundleHash(dps[i]));
  //ç­‰å¾…ä¸‹è½½
  yield return dwww;
  //å¯¼å…¥åˆ—è¡¨
  abs [i]=dwww. assetBund7e;
  //è·å–æ‰€æœ‰èµ„æº(è°ƒè¯•ä½¿ç”¨)
  object[] o = abs[i].LoadA17Assets();
  //æ‰“å°ä¾èµ–èµ„æºåç§°éªŒè¯(è°ƒè¯•ä½¿ç”¨)
  Debug.Log((o[0] as Material).name);
}
```

### 9.3.5 ä¸‹è½½ç›®æ ‡èµ„æº
```CS
//ä¾èµ–èµ„æºä¸‹è½½å®Œæ¯•ä¹‹å,ä¸‹è½½ä¸»èµ„æº
WWW www = www. LoadFromCacheOrDownload(Cdn + realNameï¼Œ mainfest.GetAssetBundl1eHash(realName));
//ç­‰å¾…ä¸‹è½½
yield return www;
///å¼‚å¸¸å¤„ç† 
if (!string.IsNullorEmpty (www.error))
{
  Debug.Log (www.error);
}
else
{
  //è·å–èµ„æº
  AssetBundle ab = www.assetBundle;
  //è·å–æ‰€æœ‰èµ„æº
  object[] oo = ab.LoadA11Assets();
  //è·å–é¢„è®¾ä½“
  Gameobject gobj = oo[0] as Gameobject;
  if (gobj !=null)
  {
    //åŠ è½½å½“åœºæ™¯
    Instantiate(gobj);
  }
  //æš‚ä¸é”€æ¯èµ„æº
  ab. Unload(false);
}
//æš‚ä¸é”€æ¯ä¾èµ–èµ„æº,æ–¹ä¾¿ä¸‹é¢ç»§ç»­ä½¿ç”¨ã€‚å¦‚æœä¸åœ¨éœ€è¦å¯ä»¥é”€æ¯
foreach (AssetBund1e ab in abs)
{
  //æš‚ä¸é”€æ¯èµ„æº
  ab. Un1oad(false) ;
}

```